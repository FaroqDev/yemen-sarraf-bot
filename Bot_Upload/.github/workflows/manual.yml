name: ðŸ› ï¸ Full City Update

on:
  workflow_dispatch:
    inputs:
      city:
        description: 'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©'
        required: true
        type: choice
        options:
        - sanaa
        - aden
      usd_buy:
        description: 'ðŸ‡ºðŸ‡¸ Ø¯ÙˆÙ„Ø§Ø± (Ø´Ø±Ø§Ø¡)'
        required: true
        type: string
      usd_sell:
        description: 'ðŸ‡ºðŸ‡¸ Ø¯ÙˆÙ„Ø§Ø± (Ø¨ÙŠØ¹)'
        required: true
        type: string
      sar_buy:
        description: 'ðŸ‡¸ðŸ‡¦ Ø³Ø¹ÙˆØ¯ÙŠ (Ø´Ø±Ø§Ø¡)'
        required: true
        type: string
      sar_sell:
        description: 'ðŸ‡¸ðŸ‡¦ Ø³Ø¹ÙˆØ¯ÙŠ (Ø¨ÙŠØ¹)'
        required: true
        type: string
      send_notification:
        description: 'Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±ØŸ'
        required: true
        type: boolean
        default: true

jobs:
  update-price:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      
      - name: Install Libs
        run: pip install firebase-admin yfinance

      - name: Create Key
        run: echo '${{ secrets.FIREBASE_JSON_KEY }}' > service-account.json

      - name: Create .env file
        # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù .env Ù…Ù† GitHub Secrets
        run: |
          cd ..
          echo "FIREBASE_DATABASE_URL=${{ secrets.FIREBASE_DATABASE_URL }}" > .env
          echo "BOT_TOKEN=${{ secrets.BOT_TOKEN }}" >> .env
          echo "TELEGRAM_CHAT_ID=${{ secrets.TELEGRAM_CHAT_ID }}" >> .env
          echo "SAFETY_THRESHOLD=50" >> .env

      - name: Run Update Script
        # Ù†Ù…Ø±Ø± Ø§Ù„Ù€ 6 Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
        run: python manual_update.py ${{ inputs.city }} ${{ inputs.usd_buy }} ${{ inputs.usd_sell }} ${{ inputs.sar_buy }} ${{ inputs.sar_sell }} ${{ inputs.send_notification }}